# Phase 2: Rendering Pipeline Performance Analysis

Slay the Spire ë Œë”ë§ íŒŒì´í”„ë¼ì¸ì˜ ì„±ëŠ¥ ë³‘ëª© í˜„ìƒ ë¶„ì„ ë° í•´ê²° ë°©ë²•

## ðŸ“‹ ë¶„ì„ ê°œìš”

**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**:
- `AbstractCard.java` - ì¹´ë“œ ë Œë”ë§
- `AbstractMonster.java` - ëª¬ìŠ¤í„° ë Œë”ë§
- `AbstractRelic.java` - ìœ ë¬¼ ë Œë”ë§
- `AbstractPotion.java` - í¬ì…˜ ë Œë”ë§
- `ImageMaster.java` - í…ìŠ¤ì²˜ ê´€ë¦¬

**ë¶„ì„ ê¸°ê°„**: 2025-11-08
**ì´ ë°œê²¬ëœ ì´ìŠˆ**: 4ê°œ (ì£¼ìš” ì„±ëŠ¥ ë³‘ëª©)

## ðŸŽ¯ ë°œê²¬ëœ ì£¼ìš” ì„±ëŠ¥ ì´ìŠˆ

### 1. **ë¹ˆë²ˆí•œ SpriteBatch ì „í™˜** âš¡ ì‹¬ê°
**íŒŒì¼**: `04_BatchSwitching.md`

**ë¬¸ì œ**:
- Spine ì• ë‹ˆë©”ì´ì…˜ ë Œë”ë§ì„ ìœ„í•´ ëª¬ìŠ¤í„°ë§ˆë‹¤ SpriteBatchë¥¼ ì „í™˜
- ëª¬ìŠ¤í„° 3ë§ˆë¦¬ ê¸°ì¤€: í”„ë ˆìž„ë‹¹ 6íšŒ ì „í™˜ (ì´ˆë‹¹ 360íšŒ)
- GPU ìƒíƒœ ë³€ê²½ ì˜¤ë²„í—¤ë“œ ë° ë“œë¡œìš°ì½œ í”ŒëŸ¬ì‹œ ë°œìƒ

**ì˜í–¥**:
- CPU ì‚¬ìš©ë¥  5-10% ì¦ê°€
- ì €ì‚¬ì–‘ PCì—ì„œ í‰ê·  FPS 15% ì €í•˜

**í•´ê²° ë°©ë²•**:
- ë°°ì¹˜ ê·¸ë£¹í™”: ê°™ì€ íƒ€ìž… ë Œë”ë§ í•œ ë²ˆì— ì²˜ë¦¬
- í”„ë ˆìž„ë²„í¼ ìºì‹±: ì •ì  ì• ë‹ˆë©”ì´ì…˜ í…ìŠ¤ì²˜ë¡œ ìºì‹œ
- í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼: ë™ì /ì •ì  ê°ì²´ êµ¬ë¶„í•˜ì—¬ ìµœì í™”

**ì˜ˆìƒ ê°œì„ **:
- Batch ì „í™˜ 66.7% ê°ì†Œ
- í‰ê·  FPS +15% (ì €ì‚¬ì–‘ PC)

---

### 2. **í™”ë©´ ë°– ê°ì²´ ë Œë”ë§** âš¡ ì‹¬ê°
**íŒŒì¼**: `05_OffscreenRendering.md`

**ë¬¸ì œ**:
- ì¹´ë“œ: Yì¶•ë§Œ ê²€ì‚¬ (Xì¶• ê²€ì‚¬ ëˆ„ë½)
- ëª¬ìŠ¤í„°/ìœ ë¬¼/í¬ì…˜: í™”ë©´ ë°– ê²€ì‚¬ ì™„ì „ ëˆ„ë½
- ë±ì˜ ë‚˜ë¨¸ì§€ ì¹´ë“œ 30-60ìž¥ì´ í™”ë©´ ë°–ì—ì„œë„ ë Œë”ë§ë¨

**ì˜í–¥**:
- ë¶ˆí•„ìš”í•œ ë“œë¡œìš°ì½œ 35-70ê°œ/í”„ë ˆìž„
- ì¹´ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì‹¬ê°í•œ FPS ë“œë¡­

**í•´ê²° ë°©ë²•**:
- í–¥ìƒëœ Frustum Culling: X+Yì¶• ëª¨ë‘ ê²€ì‚¬
- Quadtree ê³µê°„ ë¶„í• : ëŒ€ê·œëª¨ ì»¬ë ‰ì…˜ì— ì ìš©
- í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼: ê°ì²´ íƒ€ìž…ë³„ ìµœì  ì „ëžµ

**ì˜ˆìƒ ê°œì„ **:
- ë“œë¡œìš°ì½œ 71-92% ê°ì†Œ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ë·°)
- ì¹´ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ FPS +15-25

---

### 3. **ë¶ˆí•„ìš”í•œ ìƒ‰ìƒ ì„¤ì •** âš ï¸ ì¤‘ê°„
**íŒŒì¼**: `06_RedundantColorSetting.md`

**ë¬¸ì œ**:
- ë§¤ í”„ë ˆìž„ ë™ì¼í•œ ìƒ‰ìƒì„ ë°˜ë³µ ì„¤ì •
- `new Color()` ê°ì²´ë¥¼ ë§¤ í”„ë ˆìž„ ìƒì„± (GC ì••ë ¥)
- ìƒ‰ìƒ ë³€ê²½ìœ¼ë¡œ ì¸í•œ ë°°ì¹­ ì €í•´

**ì˜í–¥**:
- í”„ë ˆìž„ë‹¹ 85-100íšŒ ë¶ˆí•„ìš”í•œ ìƒ‰ìƒ ì„¤ì •
- ì´ˆë‹¹ 180ê°œ Color ê°ì²´ ìƒì„±
- GPU ìƒíƒœ ë³€ê²½ ì˜¤ë²„í—¤ë“œ

**í•´ê²° ë°©ë²•**:
- Color ê°ì²´ ìºì‹±: ì •ì  Color ìž¬ì‚¬ìš©
- ì¡°ê±´ë¶€ ìƒ‰ìƒ ì„¤ì •: ì‹¤ì œ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ í˜¸ì¶œ
- ë°°ì¹˜ ìµœì í™”: ê°™ì€ ìƒ‰ìƒ ê·¸ë£¹í™”í•˜ì—¬ ë Œë”ë§

**ì˜ˆìƒ ê°œì„ **:
- ìƒ‰ìƒ ì„¤ì • 70-76% ê°ì†Œ
- GC ì••ë ¥ 90% ê°ì†Œ
- FPS +3-5

---

### 4. **Glow íš¨ê³¼ ì˜¤ë²„í—¤ë“œ** âš ï¸ ì¤‘ê°„
**íŒŒì¼**: `07_GlowEffectOverhead.md`

**ë¬¸ì œ**:
- ì¹´ë“œ 1ìž¥ë‹¹ ì´ˆë‹¹ 3.3ê°œ `CardGlowBorder` ê°ì²´ ìƒì„±
- Flash íš¨ê³¼: ê°™ì€ ì´ë¯¸ì§€ë¥¼ 3ë²ˆ ê·¸ë¦¼
- ìœ ë¬¼ 15ê°œ ê¹œë¹¡ìž„ ì‹œ: ì´ˆë‹¹ 1,800íšŒ ë¸”ë Œë“œ ì „í™˜

**ì˜í–¥**:
- ë¹›ë‚˜ëŠ” ì¹´ë“œ 20ìž¥ â†’ ë¶„ë‹¹ 4,000ê°œ ê°ì²´ ìƒì„±
- ë†’ì€ GC ì••ë ¥ ë° ë“œë¡œìš°ì½œ ì¦ê°€

**í•´ê²° ë°©ë²•**:
- ê°ì²´ í’€ë§: CardGlowBorder ìž¬ì‚¬ìš©
- í†µí•© ë Œë”ë§: Flash íš¨ê³¼ ê·¸ë£¹í™”
- Shader ê¸°ë°˜: GPUì—ì„œ Glow ì²˜ë¦¬

**ì˜ˆìƒ ê°œì„ **:
- ê°ì²´ ìƒì„± 100% ì œê±° (í’€ë§)
- ë¸”ë Œë“œ ì „í™˜ 93.3% ê°ì†Œ
- GC ë¹ˆë„ 50-70% ê°ì†Œ
- FPS +5-8 (ë ˆë²¨ì—… í™”ë©´)

---

## ðŸ“Š í†µí•© ì„±ëŠ¥ ê°œì„  íš¨ê³¼

### ì „íˆ¬ ì‹œë‚˜ë¦¬ì˜¤ (ëª¬ìŠ¤í„° 3ë§ˆë¦¬, ì¹´ë“œ 10ìž¥, ìœ ë¬¼ 15ê°œ)

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| **SpriteBatch ì „í™˜** | 360íšŒ/ì´ˆ | 120íšŒ/ì´ˆ | 66.7% â†“ |
| **í™”ë©´ ë°– ë“œë¡œìš°ì½œ** | 35-70ê°œ/í”„ë ˆìž„ | 0-5ê°œ/í”„ë ˆìž„ | 85-100% â†“ |
| **ìƒ‰ìƒ ì„¤ì •** | 85-100íšŒ/í”„ë ˆìž„ | 20-30íšŒ/í”„ë ˆìž„ | 70-76% â†“ |
| **ê°ì²´ ìƒì„±** | 200ê°œ/ì´ˆ | 0ê°œ/ì´ˆ | 100% â†“ |

### FPS ì˜í–¥ (ì˜ˆìƒ)

| ì‹œë‚˜ë¦¬ì˜¤ | ê°œì„  ì „ FPS | ê°œì„  í›„ FPS | í–¥ìƒ |
|----------|-------------|-------------|------|
| **ì¼ë°˜ ì „íˆ¬** | 45-50 | 55-60 | +18-22% |
| **ì¹´ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬** | 30-35 | 50-55 | +57-67% |
| **ë ˆë²¨ì—… í™”ë©´** | 40-45 | 52-58 | +26-30% |
| **ë³´ìŠ¤ ì „íˆ¬** | 35-40 | 48-53 | +32-37% |

### ì‹œìŠ¤í…œ ìžì› ì˜í–¥

- **CPU ì‚¬ìš©ë¥ **: 10-15% ê°ì†Œ (ë Œë”ë§ ë£¨í”„)
- **GPU ì‚¬ìš©ë¥ **: 15-20% ê°ì†Œ (ìƒíƒœ ë³€ê²½)
- **ë©”ëª¨ë¦¬ ì‚¬ìš©**: 10-15% ê°ì†Œ (ê°ì²´ í’€ë§)
- **GC ë¹ˆë„**: 50-70% ê°ì†Œ (ê°ì²´ ìƒì„± ì œê±°)
- **ë°°í„°ë¦¬ ìˆ˜ëª…** (ëª¨ë°”ì¼): 10-15% ê°œì„ 

---

## ðŸ”§ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### í•„ìˆ˜ (Critical) - ì¦‰ì‹œ ì ìš© ê¶Œìž¥
1. **í™”ë©´ ë°– ê°ì²´ ë Œë”ë§** ì œê±°
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì„±ëŠ¥ ê°œì„ : ë§¤ìš° ë†’ìŒ (FPS +15-25)
   - íŒŒì¼: AbstractCard.java, AbstractMonster.java

2. **SpriteBatch ê·¸ë£¹í™”**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì„±ëŠ¥ ê°œì„ : ë†’ìŒ (FPS +5-10)
   - íŒŒì¼: AbstractMonster.java ë Œë”ë§ ë£¨í”„

### ê¶Œìž¥ (High Priority) - ì¡°ê¸° ì ìš© ê¶Œìž¥
3. **Color ê°ì²´ ìºì‹±**
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì„±ëŠ¥ ê°œì„ : ì¤‘ê°„ (FPS +3-5, GC ì••ë ¥ â†“)
   - íŒŒì¼: ëª¨ë“  ë Œë”ë§ í´ëž˜ìŠ¤

4. **Glow íš¨ê³¼ í’€ë§**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì„±ëŠ¥ ê°œì„ : ì¤‘ê°„ (FPS +5-8, GC ì••ë ¥ â†“)
   - íŒŒì¼: AbstractCard.java, AbstractRelic.java

### ì„ íƒ (Medium Priority) - ìƒí™©ì— ë”°ë¼ ì ìš©
5. **í”„ë ˆìž„ë²„í¼ ìºì‹±** (Spine ì• ë‹ˆë©”ì´ì…˜)
   - êµ¬í˜„ ë‚œì´ë„: ë†’ìŒ
   - ì„±ëŠ¥ ê°œì„ : ë†’ìŒ (ë©”ëª¨ë¦¬ ì‚¬ìš© â†‘)
   - ì ìš© ëŒ€ìƒ: ì •ì  ëª¬ìŠ¤í„°ë§Œ

6. **Shader ê¸°ë°˜ Glow**
   - êµ¬í˜„ ë‚œì´ë„: ë†’ìŒ
   - ì„±ëŠ¥ ê°œì„ : ì¤‘ê°„ (GPU ì˜ì¡´)
   - ì ìš© ëŒ€ìƒ: ê³ ì„±ëŠ¥ PCë§Œ

---

## ðŸ’¡ êµ¬í˜„ ê°€ì´ë“œë¼ì¸

### 1. í™”ë©´ ë°– ê²€ì‚¬ ì¶”ê°€
```java
// AbstractCard.java
private boolean isOnScreen() {
    float marginX = IMG_WIDTH * this.drawScale * 0.2F;
    float marginY = IMG_HEIGHT * this.drawScale * 0.2F;

    return (this.current_x + marginX >= 0 &&
            this.current_x - marginX <= Settings.WIDTH &&
            this.current_y + marginY >= 0 &&
            this.current_y - marginY <= Settings.HEIGHT);
}

public void render(SpriteBatch sb) {
    if (!isOnScreen()) return;  // âœ… ì¶”ê°€
    // ê¸°ì¡´ ë Œë”ë§ ë¡œì§
}
```

### 2. SpriteBatch ê·¸ë£¹í™”
```java
// MonsterGroup.java (ë Œë”ë§ ë£¨í”„)
public void render(SpriteBatch sb) {
    // ì¼ë°˜ ì´ë¯¸ì§€ ë¨¼ì €
    for (Monster m : monsters) {
        if (!m.hasSpineAnimation) {
            m.render(sb);
        }
    }

    // Spine ì• ë‹ˆë©”ì´ì…˜ í•œ ë²ˆì—
    sb.end();
    CardCrawlGame.psb.begin();
    for (Monster m : monsters) {
        if (m.hasSpineAnimation) {
            m.renderSpine(CardCrawlGame.psb);
        }
    }
    CardCrawlGame.psb.end();
    sb.begin();
}
```

### 3. Color ìºì‹±
```java
public class ColorCache {
    private Color currentColor = new Color(Color.WHITE);

    public void setColor(SpriteBatch sb, Color newColor) {
        if (!currentColor.equals(newColor)) {
            currentColor.set(newColor);
            sb.setColor(newColor);
        }
    }
}
```

### 4. Glow í’€ë§
```java
public class GlowEffectPool {
    private List<CardGlowBorder> pool = new ArrayList<>(50);
    private int activeCount = 0;

    public CardGlowBorder obtain(AbstractCard card, Color color) {
        if (activeCount < pool.size()) {
            CardGlowBorder glow = pool.get(activeCount++);
            glow.reset(card, color);
            return glow;
        }
        // í’€ì´ ê°€ë“ ì°¼ìœ¼ë©´ ìž¬ì‚¬ìš©
        return pool.get(0);
    }
}
```

---

## ðŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ì„±ëŠ¥ ì¸¡ì •
```java
// FPS ì¸¡ì •
float fps = Gdx.graphics.getFramesPerSecond();
System.out.println("FPS: " + fps);

// ë“œë¡œìš°ì½œ ì¹´ìš´íŠ¸
int drawCalls = renderer.getDrawCallCount();
System.out.println("Draw calls: " + drawCalls);

// ë©”ëª¨ë¦¬ ì‚¬ìš©
long memory = Runtime.getRuntime().totalMemory() -
              Runtime.getRuntime().freeMemory();
System.out.println("Memory: " + memory / 1024 / 1024 + "MB");
```

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ì¼ë°˜ ì „íˆ¬**: ëª¬ìŠ¤í„° 3ë§ˆë¦¬, ì¹´ë“œ 10ìž¥
2. **ì¹´ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬**: ì „ì²´ ì»¬ë ‰ì…˜ ìŠ¤í¬ë¡¤
3. **ë ˆë²¨ì—…**: ëª¨ë“  ìœ ë¬¼ ê¹œë¹¡ìž„
4. **ë³´ìŠ¤ ì „íˆ¬**: Spine ì• ë‹ˆë©”ì´ì…˜ ë³´ìŠ¤

### ë²¤ì¹˜ë§ˆí¬ ê¸°ì¤€
- **ì €ì‚¬ì–‘ PC**: 60 FPS ì•ˆì •í™”
- **ì¤‘ê°„ ì‚¬ì–‘**: 120 FPS ë‹¬ì„±
- **ê³ ì‚¬ì–‘**: 144 FPS+ ìœ ì§€

---

## ðŸ“š ì°¸ê³  ìžë£Œ

### ë‚´ë¶€ ë¬¸ì„œ
- [01_ObjectPooling.md](./01_ObjectPooling.md) - ê°ì²´ í’€ë§ ê¸°ì´ˆ
- [02_TextureAtlas.md](./02_TextureAtlas.md) - í…ìŠ¤ì²˜ ìµœì í™”
- [03_StringConcatenation.md](./03_StringConcatenation.md) - ë¬¸ìžì—´ ìµœì í™”

### ì™¸ë¶€ ìžë£Œ
- [libGDX Performance Guide](https://github.com/libgdx/libgdx/wiki/Performance-tuning)
- [SpriteBatch Optimization](https://github.com/libgdx/libgdx/wiki/Spritebatch%2C-Textureregions%2C-and-Sprites)
- [Spine Runtime Optimization](http://esotericsoftware.com/spine-runtime-optimization)

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ì¼ë°˜ì ì¸ í•¨ì •
1. **Z-ordering**: ê·¸ë£¹í™” ì‹œ ë Œë”ë§ ìˆœì„œ ìœ ì§€ í•„ìš”
2. **ë¸”ë Œë“œ ëª¨ë“œ**: Spine ë Œë”ë§ í›„ ë°˜ë“œì‹œ ë³µì›
3. **ë©”ëª¨ë¦¬**: ìºì‹±ì€ ë©”ëª¨ë¦¬ ì—¬ìœ  ìžˆì„ ë•Œë§Œ
4. **ëª¨ë°”ì¼**: ì €ì‚¬ì–‘ ê¸°ê¸°ëŠ” Shader ì§€ì› í™•ì¸

### ë””ë²„ê¹… íŒ
```java
// ë“œë¡œìš°ì½œ ì‹œê°í™”
if (DEBUG) {
    System.out.println("Draw calls this frame: " + drawCalls);
    System.out.println("Batch switches: " + batchSwitches);
}

// í™”ë©´ ë°– ê°ì²´ í‘œì‹œ
if (DEBUG && !isOnScreen()) {
    sb.setColor(Color.RED);
    sb.draw(debugTexture, x, y);  // ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬
}
```

---

## ðŸ“ ë²„ì „ ížˆìŠ¤í† ë¦¬

- **2025-11-08**: Phase 2 ë¶„ì„ ì™„ë£Œ
  - 4ê°œ ì£¼ìš” ë Œë”ë§ ì´ìŠˆ ë°œê²¬
  - í†µí•© ê°œì„  íš¨ê³¼ ì˜ˆì¸¡
  - êµ¬í˜„ ê°€ì´ë“œë¼ì¸ ìž‘ì„±

---

## ðŸ¤ ê¸°ì—¬

ì„±ëŠ¥ ê°œì„  ì œì•ˆì´ë‚˜ ì¶”ê°€ ìµœì í™” ì•„ì´ë””ì–´ê°€ ìžˆë‹¤ë©´ ì´ìŠˆë¡œ ë“±ë¡í•´ì£¼ì„¸ìš”.

**ìž‘ì„±ìž**: Claude (AI Assistant)
**í”„ë¡œì íŠ¸**: sts-mods
**ë¼ì´ì„ ìŠ¤**: MIT
